(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,82568,e=>{"use strict";var t,s,a,n,r,i,l,o;let c,d,u,h,p,m;(n=t||(t={})).Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE";class g extends Error{constructor(e,t,s){super(e),this.message=e,this.code=t,this.data=s}}let x=(c=(i=r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g).CapacitorCustomPlatform||null,u=(d=i.Capacitor||{}).Plugins=d.Plugins||{},h=()=>{var e,t;return null!==c?c.name:(null==i?void 0:i.androidBridge)?"android":(null==(t=null==(e=null==i?void 0:i.webkit)?void 0:e.messageHandlers)?void 0:t.bridge)?"ios":"web"},p=e=>{var t;return null==(t=d.PluginHeaders)?void 0:t.find(t=>t.name===e)},m=new Map,d.convertFileSrc||(d.convertFileSrc=e=>e),d.getPlatform=h,d.handleError=e=>i.console.error(e),d.isNativePlatform=()=>"web"!==h(),d.isPluginAvailable=e=>{let t=m.get(e);return!!((null==t?void 0:t.platforms.has(h()))||p(e))},d.registerPlugin=(e,s={})=>{let a,n=m.get(e);if(n)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),n.proxy;let r=h(),i=p(e),l=async()=>(!a&&r in s?a=a="function"==typeof s[r]?await s[r]():s[r]:null!==c&&!a&&"web"in s&&(a=a="function"==typeof s.web?await s.web():s.web),a),o=s=>{let a,n=(...n)=>{let o=l().then(l=>{let o=((s,a)=>{var n,l;if(i){let t=null==i?void 0:i.methods.find(e=>a===e.name);if(t)if("promise"===t.rtype)return t=>d.nativePromise(e,a.toString(),t);else return(t,s)=>d.nativeCallback(e,a.toString(),t,s);if(s)return null==(n=s[a])?void 0:n.bind(s)}else if(s)return null==(l=s[a])?void 0:l.bind(s);else throw new g(`"${e}" plugin is not implemented on ${r}`,t.Unimplemented)})(l,s);if(o){let e=o(...n);return a=null==e?void 0:e.remove,e}throw new g(`"${e}.${s}()" is not implemented on ${r}`,t.Unimplemented)});return"addListener"===s&&(o.remove=async()=>a()),o};return n.toString=()=>`${s.toString()}() { [capacitor code] }`,Object.defineProperty(n,"name",{value:s,writable:!1,configurable:!1}),n},x=o("addListener"),y=o("removeListener"),f=(e,t)=>{let s=x({eventName:e},t),a=async()=>{y({eventName:e,callbackId:await s},t)},n=new Promise(e=>s.then(()=>e({remove:a})));return n.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await a()},n},w=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return i?f:x;case"removeListener":return y;default:return o(t)}}});return u[e]=w,m.set(e,{name:e,proxy:w,platforms:new Set([...Object.keys(s),...i?[r]:[]])}),w},d.Exception=g,d.DEBUG=!!d.DEBUG,d.isLoggingEnabled=!!d.isLoggingEnabled,r.Capacitor=d),y=x.registerPlugin;class f{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let s=!1;this.listeners[e]||(this.listeners[e]=[],s=!0),this.listeners[e].push(t);let a=this.windowListeners[e];return a&&!a.registered&&this.addWindowListener(a),s&&this.sendRetainedArgumentsForEvent(e),Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){for(let e in this.listeners={},this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,s){let a=this.listeners[e];if(!a){if(s){let s=this.retainedEventArguments[e];s||(s=[]),s.push(t),this.retainedEventArguments[e]=s}return}a.forEach(e=>e(t))}hasListeners(e){var t;return!!(null==(t=this.listeners[e])?void 0:t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new x.Exception(e,t.Unimplemented)}unavailable(e="not available"){return new x.Exception(e,t.Unavailable)}async removeListener(e,t){let s=this.listeners[e];if(!s)return;let a=s.indexOf(t);this.listeners[e].splice(a,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){let t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(t=>{this.notifyListeners(e,t)}))}}let w=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);class b extends f{async getCookies(){let e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[s,a]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");s=s.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent).trim(),a=a.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent).trim(),t[s]=a}),t}async setCookie(e){try{let t=w(e.key),s=w(e.value),a=`; expires=${(e.expires||"").replace("expires=","")}`,n=(e.path||"/").replace("path=",""),r=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${s||""}${a}; path=${n}; ${r};`}catch(e){return Promise.reject(e)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{for(let e of document.cookie.split(";")||[])document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}y("CapacitorCookies",{web:()=>new b});let v=async e=>new Promise((t,s)=>{let a=new FileReader;a.onload=()=>{let e=a.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},a.onerror=e=>s(e),a.readAsDataURL(e)});class _ extends f{async request(e){let t,s,a=((e,t={})=>{let s=Object.assign({method:e.method||"GET",headers:e.headers},t),a=((e={})=>{let t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((s,a,n)=>(s[a]=e[t[n]],s),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)s.body=e.data;else if(a.includes("application/x-www-form-urlencoded")){let t=new URLSearchParams;for(let[s,a]of Object.entries(e.data||{}))t.set(s,a);s.body=t.toString()}else if(a.includes("multipart/form-data")||e.data instanceof FormData){let t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,s)=>{t.append(s,e)});else for(let s of Object.keys(e.data))t.append(s,e.data[s]);s.body=t;let a=new Headers(s.headers);a.delete("content-type"),s.headers=a}else(a.includes("application/json")||"object"==typeof e.data)&&(s.body=JSON.stringify(e.data));return s})(e,e.webFetchExtra),n=((e,t=!0)=>e?Object.entries(e).reduce((e,s)=>{let a,n,[r,i]=s;return Array.isArray(i)?(n="",i.forEach(e=>{a=t?encodeURIComponent(e):e,n+=`${r}=${a}&`}),n.slice(0,-1)):(a=t?encodeURIComponent(i):i,n=`${r}=${a}`),`${e}&${n}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),r=n?`${e.url}?${n}`:e.url,i=await fetch(r,a),l=i.headers.get("content-type")||"",{responseType:o="text"}=i.ok?e:{};switch(l.includes("application/json")&&(o="json"),o){case"arraybuffer":case"blob":s=await i.blob(),t=await v(s);break;case"json":t=await i.json();break;default:t=await i.text()}let c={};return i.headers.forEach((e,t)=>{c[t]=e}),{data:t,headers:c,status:i.status,url:i.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}let j=y("CapacitorHttp",{web:()=>new _});(l=s||(s={})).Dark="DARK",l.Light="LIGHT",l.Default="DEFAULT",(o=a||(a={})).StatusBar="StatusBar",o.NavigationBar="NavigationBar";class k extends f{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}y("SystemBars",{web:()=>new k}),e.s(["Capacitor",()=>x,"CapacitorHttp",()=>j,"WebPlugin",()=>f,"registerPlugin",()=>y])},4710,34983,e=>{"use strict";var t=e.i(82568);let s=(0,t.registerPlugin)("Preferences",{web:()=>e.A(41283).then(e=>new e.PreferencesWeb)}),a="wellness_data",n=new class{data={};initialized=!1;async initialize(){if(!this.initialized)try{let{value:e}=await s.get({key:a});e&&(this.data=JSON.parse(e)),this.initialized=!0,console.log("Database initialized successfully")}catch(e){console.error("Failed to initialize database:",e),this.data={},this.initialized=!0}}async save(){await s.set({key:a,value:JSON.stringify(this.data)})}async saveWellness(e){this.initialized||await this.initialize();let t=this.data[e.date]||{date:e.date};this.data[e.date]={date:e.date,wellness:e.wellness||t.wellness||null,sleep:e.sleep||t.sleep||null,hrv:e.hrv||t.hrv||null,stress:e.stress||t.stress||null,activity:e.activity||t.activity||null},await this.save()}async getWellness(e){return this.initialized||await this.initialize(),this.data[e]||null}async getLatestDate(){return this.initialized||await this.initialize(),Object.keys(this.data).sort().reverse()[0]||null}async getHistory(e){return this.initialized||await this.initialize(),Object.keys(this.data).sort().reverse().slice(0,e).map(e=>this.data[e])}async getStats(){this.initialized||await this.initialize();let e=Object.keys(this.data).sort();return{total_days:e.length,earliest_date:e[0]||null,latest_date:e[e.length-1]||null}}async clear(){this.data={},await s.remove({key:a})}};e.s(["db",0,n],34983);let r=t.Capacitor.isNativePlatform();async function i(e,s){if(r){let a=await t.CapacitorHttp.get({url:e,headers:s||{}});return{data:a.data,status:a.status}}{let t=await fetch(e,{headers:s,credentials:"include"});return{data:await t.json().catch(()=>t.text()),status:t.status}}}async function l(e,s,a){if(r){let n=await t.CapacitorHttp.post({url:e,headers:a||{},data:s});return{data:n.data,status:n.status,headers:n.headers}}{let t=await fetch(e,{method:"POST",headers:a,body:"string"==typeof s?s:JSON.stringify(s),credentials:"include"}),n=await t.json().catch(()=>t.text()),r={};return t.headers.forEach((e,t)=>r[t]=e),{data:n,status:t.status,headers:r}}}async function o(e,s){if(r){let a=await t.CapacitorHttp.get({url:e,headers:s||{},responseType:"text"});return{data:a.data,status:a.status}}{let t=await fetch(e,{headers:s,credentials:"include"});return{data:await t.text(),status:t.status}}}let c="https://connectapi.garmin.com/oauth-service/oauth",d="garmin_tokens",u=new class{oauth1Token=null;oauth2Token=null;isRefreshing=!1;refreshQueue=[];constructor(){this.loadTokens()}async loadTokens(){try{let{value:e}=await s.get({key:d});if(e){let t=JSON.parse(e);this.oauth1Token=t.oauth1,this.oauth2Token=t.oauth2}}catch(e){console.error("Failed to load tokens:",e)}}async saveTokens(){try{let e={oauth1:this.oauth1Token,oauth2:this.oauth2Token};await s.set({key:d,value:JSON.stringify(e)})}catch(e){console.error("Failed to save tokens:",e)}}async logout(){this.oauth1Token=null,this.oauth2Token=null,await s.remove({key:d})}async isAuthenticated(){return await this.loadTokens(),null!==this.oauth2Token}async login(e,t){try{return await s.set({key:"garmin_email",value:e}),await s.set({key:"garmin_password",value:t}),this.oauth2Token={access_token:"pending_sync",token_type:"Bearer",expires_in:3600,expires_at:Date.now()+36e5},await this.saveTokens(),{success:!0}}catch(e){return console.error("Login error:",e),{success:!1,error:e instanceof Error?e.message:"Failed to save credentials"}}}async syncViaBackend(e=7,t){try{let{value:a}=await s.get({key:"garmin_email"}),{value:r}=await s.get({key:"garmin_password"});if(!a||!r)return{success:!1,daysProcessed:0,error:"Not authenticated"};let o="http://localhost:8000";console.log("Syncing via backend API..."),t?.(0,e);let c=await l(`${o}/api/v1/garmin/sync-wellness`,JSON.stringify({email:a,password:r,days:e}),{"Content-Type":"application/json",Accept:"application/json"});if(200!==c.status){let s=c.data,a=s?.detail||`Backend sync failed (${c.status})`;if(0===c.status||a.includes("fetch"))return console.log("Backend not available, attempting direct sync..."),this.sync(e,t);return{success:!1,daysProcessed:0,error:a}}let d=c.data;console.log("Sync complete, fetching wellness data..."),t?.(Math.floor(.8*e),e);let u=await i(`${o}/api/v1/garmin/wellness-history?days=${e}`,{Accept:"application/json"});if(200===u.status){let e=u.data;if(e.success&&e.days){for(let t of(console.log(`Saving ${e.days.length} days to local storage...`),await n.initialize(),e.days)){let e=t.sleep_hours?3600*t.sleep_hours:0,s=t.deep_sleep_pct||0,a=t.rem_sleep_pct||0;await n.saveWellness({date:t.date,wellness:{date:t.date,fetched_at:new Date().toISOString(),resting_heart_rate:t.resting_heart_rate,training_readiness_score:null},sleep:e>0?{date:t.date,sleep_start:null,sleep_end:null,total_sleep_seconds:e,deep_sleep_seconds:Math.round(e*s/100),light_sleep_seconds:Math.round(e*(100-s-a)/100),rem_sleep_seconds:Math.round(e*a/100),awake_seconds:0,sleep_score:t.sleep_score,sleep_efficiency:null,avg_spo2:null,avg_respiration:null}:null,hrv:t.hrv?{date:t.date,hrv_weekly_avg:null,hrv_last_night_avg:t.hrv,hrv_last_night_5min_high:null,hrv_status:t.hrv_status,baseline_low:null,baseline_balanced_low:null,baseline_balanced_upper:null}:null,stress:t.body_battery_charged?{date:t.date,avg_stress_level:t.avg_stress,max_stress_level:null,rest_stress_duration:0,low_stress_duration:0,medium_stress_duration:0,high_stress_duration:0,body_battery_charged:t.body_battery_charged,body_battery_drained:t.body_battery_drained,body_battery_high:t.body_battery_high,body_battery_low:t.body_battery_low}:null,activity:t.steps?{date:t.date,steps:t.steps,steps_goal:t.steps_goal||1e4,total_distance_m:0,active_calories:t.active_calories,total_calories:null,intensity_minutes:t.intensity_minutes||0,floors_climbed:0}:null})}console.log("Local storage updated successfully")}}return t?.(e,e),{success:d.success,daysProcessed:d.synced_count,error:d.success?void 0:d.message}}catch(s){return console.error("Backend sync error:",s),console.log("Falling back to direct sync..."),this.sync(e,t)}}async exchangeTicketForOAuth1(e){try{Math.floor(Date.now()/1e3).toString(),Math.random().toString(36).substring(2,15),Math.random().toString(36).substring(2,15);let t=`${c}/preauthorized`,s=new URLSearchParams({ticket:e,"login-url":"https://sso.garmin.com/sso/embed","accepts-mfa-tokens":"true"});encodeURIComponent("E08WAR897WEy2knn7aFBrvegVAf0AFdWBBF");let a=`${t}?${s.toString()}`;console.log("OAuth1 exchange URL:",a);let n=await o(a,{"User-Agent":"com.garmin.android.apps.connectmobile",Accept:"*/*"});if(console.log("OAuth1 response status:",n.status),console.log("OAuth1 response data:",n.data?.substring(0,200)),200!==n.status)return console.error("OAuth1 failed with status:",n.status),{success:!1,error:`OAuth1 failed (${n.status})`};let r=n.data,i=new URLSearchParams(r),l=i.get("oauth_token"),d=i.get("oauth_token_secret");if(console.log("OAuth1 tokens received:",!!l,!!d),!l||!d){try{let e=JSON.parse(r);if(e.oauth_token&&e.oauth_token_secret)return this.oauth1Token={oauth_token:e.oauth_token,oauth_token_secret:e.oauth_token_secret},{success:!0}}catch{}return console.error("OAuth1 response format unexpected:",r.substring(0,200)),{success:!1,error:"Invalid OAuth1 response format"}}return this.oauth1Token={oauth_token:l,oauth_token_secret:d},{success:!0}}catch(e){return console.error("OAuth1 exchange error:",e),{success:!1,error:"OAuth1 exchange failed: "+(e instanceof Error?e.message:"unknown")}}}async exchangeOAuth1ForOAuth2(){if(!this.oauth1Token)return{success:!1,error:"No OAuth1 token available"};try{let e=Math.floor(Date.now()/1e3).toString(),t=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),s=`OAuth oauth_consumer_key="fc3e99d2-118c-44b8-8ae3-03370dde24c0", oauth_token="${this.oauth1Token.oauth_token}", oauth_signature_method="HMAC-SHA1", oauth_timestamp="${e}", oauth_nonce="${t}", oauth_version="1.0", oauth_signature="placeholder"`;console.log("OAuth2 exchange starting...");let a=await l(`${c}/exchange/user/2.0`,"",{"User-Agent":"com.garmin.android.apps.connectmobile",Authorization:s,"Content-Type":"application/x-www-form-urlencoded"});if(console.log("OAuth2 response status:",a.status),200!==a.status)return console.error("OAuth2 failed:",a.status,a.data),{success:!1,error:`OAuth2 failed (${a.status})`};let n=a.data;if(!n.access_token)return console.error("No access token in response:",n),{success:!1,error:"No access token received"};return this.oauth2Token={access_token:n.access_token,token_type:n.token_type||"Bearer",expires_in:n.expires_in||3600,refresh_token:n.refresh_token,expires_at:Date.now()+1e3*(n.expires_in||3600)},console.log("OAuth2 token received successfully"),{success:!0}}catch(e){return console.error("OAuth2 exchange error:",e),{success:!1,error:"OAuth2 exchange failed: "+(e instanceof Error?e.message:"unknown")}}}async apiRequest(e){if(!this.oauth2Token)throw Error("Not authenticated");this.oauth2Token.expires_at&&Date.now()>=this.oauth2Token.expires_at&&await this.refreshToken();try{let t=await i(`https://connect.garmin.com${e}`,{Authorization:`Bearer ${this.oauth2Token.access_token}`,"User-Agent":"com.garmin.android.apps.connectmobile",Accept:"application/json"});if(401===t.status)return await this.refreshToken(),this.apiRequest(e);if(200!==t.status)return console.error(`API request failed: ${t.status}`),null;return t.data}catch(e){return console.error("API request error:",e),null}}async refreshToken(){if(this.isRefreshing)return new Promise(e=>{this.refreshQueue.push(e)});this.isRefreshing=!0;try{(await this.exchangeOAuth1ForOAuth2()).success&&await this.saveTokens()}finally{this.isRefreshing=!1,this.refreshQueue.forEach(e=>e()),this.refreshQueue=[]}}async fetchSleep(e){let t=await this.apiRequest(`/wellness-service/wellness/dailySleep?date=${e}`);if(!t)return null;let s=t.deepSleepSeconds||0,a=t.lightSleepSeconds||0,n=t.remSleepSeconds||0,r=t.awakeSleepSeconds||0,i=s+a+n,l=i+r;return{date:e,sleep_start:t.sleepStartTimestampLocal||null,sleep_end:t.sleepEndTimestampLocal||null,total_sleep_seconds:i,deep_sleep_seconds:s,light_sleep_seconds:a,rem_sleep_seconds:n,awake_seconds:r,sleep_score:t.sleepScores?.overall?.value||null,sleep_efficiency:Math.round(10*(l>0?i/l*100:0))/10,avg_spo2:t.avgOxygenSaturation||null,avg_respiration:t.avgSleepRespirationValue||null}}async fetchHRV(e){let t=await this.apiRequest(`/hrv-service/hrv/${e}`);if(!t)return null;let s=t.hrvSummary||{},a=s.baseline||{};return{date:e,hrv_weekly_avg:s.weeklyAvg||null,hrv_last_night_avg:s.lastNightAvg||null,hrv_last_night_5min_high:s.lastNight5MinHigh||null,hrv_status:s.status||null,baseline_low:a.lowUpper||null,baseline_balanced_low:a.balancedLow||null,baseline_balanced_upper:a.balancedUpper||null}}async fetchStress(e){let t=await this.apiRequest(`/wellness-service/wellness/dailyStress/${e}`),s=await this.apiRequest(`/wellness-service/wellness/bodyBattery/reports/daily?startDate=${e}&endDate=${e}`),a=s&&s.length>0?s[0]:null;return t||a?{date:e,avg_stress_level:t?.overallStressLevel||null,max_stress_level:t?.maxStressLevel||null,rest_stress_duration:t?.restStressDuration||0,low_stress_duration:t?.lowStressDuration||0,medium_stress_duration:t?.mediumStressDuration||0,high_stress_duration:t?.highStressDuration||0,body_battery_charged:a?.charged||null,body_battery_drained:a?.drained||null,body_battery_high:a?.highBB||null,body_battery_low:a?.lowBB||null}:null}async fetchActivity(e){let t=await this.apiRequest(`/usersummary-service/stats/steps/daily/${e}/${e}`),s=t&&t.length>0?t[0]:null,a=await this.apiRequest(`/usersummary-service/usersummary/daily/${e}`),n=s?.totalSteps||0,r=s?.stepGoal||1e4,i=s?.totalDistance||0;a&&(0===n&&(n=a.totalSteps||0),1e4===r&&(r=a.dailyStepGoal||1e4),0===i&&(i=a.totalDistanceMeters||0));let l=a?.activeKilocalories||null,o=a?.totalKilocalories||null,c=a?.floorsAscended||0,d=a?.moderateIntensityMinutes||0,u=a?.vigorousIntensityMinutes||0;return 0===n&&null===l?null:{date:e,steps:n,steps_goal:r,total_distance_m:i,active_calories:l,total_calories:o,intensity_minutes:d+u,floors_climbed:c}}async fetchRestingHeartRate(e){let t=await this.apiRequest(`/wellness-service/wellness/dailyHeartRate?date=${e}`);if(!t)return null;let s=t.restingHeartRate;return s&&s>0?s:null}async fetchWellness(e){console.log(`Fetching wellness data for ${e}...`);let[t,s,a,n,r]=await Promise.all([this.fetchSleep(e),this.fetchHRV(e),this.fetchStress(e),this.fetchActivity(e),this.fetchRestingHeartRate(e)]);return{date:e,wellness:{date:e,fetched_at:new Date().toISOString(),resting_heart_rate:r,training_readiness_score:null},sleep:t,hrv:s,stress:a,activity:n}}async sync(e=1,t){try{if(!await this.isAuthenticated())return{success:!1,daysProcessed:0,error:"Not authenticated"};await n.initialize();let s=new Date,a=0;for(let r=0;r<e;r++){let i=new Date(s);i.setDate(i.getDate()-r);let l=i.toISOString().split("T")[0];try{let s=await this.fetchWellness(l);await n.saveWellness(s),a++,t&&t(a,e)}catch(e){console.error(`Failed to fetch ${l}:`,e)}}return{success:!0,daysProcessed:a}}catch(e){return console.error("Sync error:",e),{success:!1,daysProcessed:0,error:e instanceof Error?e.message:"Sync failed"}}}};e.s(["garmin",0,u],4710)},18566,(e,t,s)=>{t.exports=e.r(76562)},2296,e=>{"use strict";var t=e.i(43476),s=e.i(18566),a=e.i(71645),n=e.i(4710);let r="garmin-wellness-sync-email";function i({onSyncComplete:e,onClose:s,className:i}){let[o,c]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),[h,p]=(0,a.useState)(30),[m,g]=(0,a.useState)(!1),[x,y]=(0,a.useState)("idle"),[f,w]=(0,a.useState)(null),[b,v]=(0,a.useState)(null),[_,j]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=localStorage.getItem(r);e&&(c(e),g(!0))},[]),(0,a.useEffect)(()=>{m&&o?localStorage.setItem(r,o):m||localStorage.removeItem(r)},[m,o]);let k=(0,a.useCallback)(async()=>{if(!o||!d)return void v("Please enter your Garmin Connect email and password");y("syncing"),v(null),j(null),w({current:0,total:h});try{let t=await n.garmin.login(o,d);if(!t.success)throw Error(t.error||"Login failed");let s=await n.garmin.sync(h,(e,t)=>{w({current:e,total:t})});if(!s.success)throw Error(s.error||"Sync failed");let a={success:!0,synced_count:s.daysProcessed,message:`Successfully synced ${s.daysProcessed} days of wellness data`,new_days:s.daysProcessed,updated_days:0,synced_days:[]};j(a),y("success"),u(""),w(null),e&&e(a)}catch(e){v(e instanceof Error?e.message:"Failed to sync wellness data"),y("error"),w(null)}},[o,d,h,e]),N=(0,a.useCallback)(()=>{y("idle"),v(null),j(null)},[]),S=!o||!d||"syncing"===x;return(0,t.jsxs)("div",{className:`bg-zinc-900 rounded-2xl border border-zinc-800 ${i||""}`,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-zinc-800",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-teal-500/20 flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-5 h-5 text-teal-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Garmin Connect"}),(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:"Sync your wellness data"})]})]}),s&&(0,t.jsx)("button",{onClick:s,className:"text-zinc-500 hover:text-white transition-colors","aria-label":"Close",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsx)("div",{className:"p-6",children:"success"===x&&_?(0,t.jsx)(l,{result:_,onReset:N,onClose:s}):(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),k()},className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-zinc-400",children:"Garmin Email"}),(0,t.jsx)("input",{type:"email",value:o,onChange:e=>c(e.target.value),placeholder:"your@email.com",autoComplete:"email",disabled:"syncing"===x,className:"w-full px-4 py-2.5 rounded-xl bg-zinc-800 border border-zinc-700 text-white placeholder-zinc-500 focus:border-teal-500 focus:ring-1 focus:ring-teal-500 focus:outline-none transition-colors disabled:opacity-50"})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-zinc-400",children:"Password"}),(0,t.jsx)("input",{type:"password",value:d,onChange:e=>u(e.target.value),placeholder:"Your Garmin Connect password",autoComplete:"current-password",disabled:"syncing"===x,className:"w-full px-4 py-2.5 rounded-xl bg-zinc-800 border border-zinc-700 text-white placeholder-zinc-500 focus:border-teal-500 focus:ring-1 focus:ring-teal-500 focus:outline-none transition-colors disabled:opacity-50"})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-zinc-400",children:"Days to sync"}),(0,t.jsxs)("select",{value:h,onChange:e=>p(Number(e.target.value)),disabled:"syncing"===x,className:"w-full px-4 py-2.5 rounded-xl bg-zinc-800 border border-zinc-700 text-white focus:border-teal-500 focus:ring-1 focus:ring-teal-500 focus:outline-none transition-colors disabled:opacity-50",children:[(0,t.jsx)("option",{value:7,children:"Last 7 days"}),(0,t.jsx)("option",{value:14,children:"Last 14 days"}),(0,t.jsx)("option",{value:30,children:"Last 30 days"}),(0,t.jsx)("option",{value:60,children:"Last 60 days"}),(0,t.jsx)("option",{value:90,children:"Last 90 days"}),(0,t.jsx)("option",{value:180,children:"Last 180 days"})]}),(0,t.jsx)("p",{className:"text-xs text-zinc-500 mt-1",children:"More days = better baselines for trend analysis"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:m,onChange:e=>g(e.target.checked),className:"w-4 h-4 rounded border-zinc-600 bg-zinc-800 text-teal-500 focus:ring-teal-500 focus:ring-offset-zinc-900"}),(0,t.jsx)("span",{className:"text-sm text-zinc-500",children:"Remember my email"})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-zinc-800/50 rounded-xl",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-zinc-500 mt-0.5 shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsx)("p",{className:"text-xs text-zinc-500",children:"Syncs sleep, HRV, stress, body battery, and activity data. Your password is not stored."})]}),b&&(0,t.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-red-900/20 border border-red-800/50 rounded-xl",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-red-400 mt-0.5 shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsx)("p",{className:"text-sm text-red-400",children:b})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,t.jsx)("button",{type:"submit",disabled:S,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl bg-teal-500 text-white font-medium hover:bg-teal-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"syncing"===x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,t.jsx)("span",{children:f?`Syncing ${f.current}/${f.total}...`:"Connecting..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),(0,t.jsx)("span",{children:"Sync Wellness Data"})]})}),s&&(0,t.jsx)("button",{type:"button",onClick:s,disabled:"syncing"===x,className:"px-4 py-2.5 rounded-xl border border-zinc-700 text-zinc-400 font-medium hover:bg-zinc-800 disabled:opacity-50 transition-colors",children:"Cancel"})]})]})})]})}function l({result:e,onReset:s,onClose:a}){return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-teal-500/20 flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-5 h-5 text-teal-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-white",children:"Sync Complete"}),(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:e.message})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{className:"bg-zinc-800 rounded-xl p-3 text-center",children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500 uppercase tracking-wide",children:"Total Days"}),(0,t.jsx)("div",{className:"text-xl font-semibold text-white mt-1",children:e.synced_count})]}),(0,t.jsxs)("div",{className:"bg-zinc-800 rounded-xl p-3 text-center",children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500 uppercase tracking-wide",children:"New"}),(0,t.jsx)("div",{className:"text-xl font-semibold text-teal-400 mt-1",children:e.new_days})]}),(0,t.jsxs)("div",{className:"bg-zinc-800 rounded-xl p-3 text-center",children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500 uppercase tracking-wide",children:"Updated"}),(0,t.jsx)("div",{className:"text-xl font-semibold text-blue-400 mt-1",children:e.updated_days})]})]}),e.synced_days&&e.synced_days.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-zinc-400",children:"Recent Days Synced"}),(0,t.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:e.synced_days.slice(0,5).map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 bg-zinc-800 rounded-lg",children:[(0,t.jsx)("span",{className:"text-sm text-white",children:e.date}),(0,t.jsxs)("div",{className:"flex gap-1",children:[e.has_sleep&&(0,t.jsx)("span",{className:"px-2 py-0.5 text-xs bg-purple-500/20 text-purple-400 rounded",children:"Sleep"}),e.has_hrv&&(0,t.jsx)("span",{className:"px-2 py-0.5 text-xs bg-green-500/20 text-green-400 rounded",children:"HRV"}),e.has_stress&&(0,t.jsx)("span",{className:"px-2 py-0.5 text-xs bg-orange-500/20 text-orange-400 rounded",children:"Stress"}),e.has_activity&&(0,t.jsx)("span",{className:"px-2 py-0.5 text-xs bg-blue-500/20 text-blue-400 rounded",children:"Activity"})]})]},e.date))})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,t.jsx)("button",{onClick:s,className:"flex-1 px-4 py-2.5 rounded-xl border border-zinc-700 text-zinc-400 font-medium hover:bg-zinc-800 transition-colors",children:"Sync Again"}),a&&(0,t.jsx)("button",{onClick:a,className:"flex-1 px-4 py-2.5 rounded-xl bg-teal-500 text-white font-medium hover:bg-teal-600 transition-colors",children:"Done"})]})]})}function o(){let e=(0,s.useRouter)();return(0,t.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,t.jsx)("nav",{className:"flex items-center justify-between px-4 py-3 border-b border-zinc-900",children:(0,t.jsxs)("button",{onClick:()=>e.push("/"),className:"flex items-center gap-2 text-zinc-400 hover:text-white transition-colors",children:[(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),(0,t.jsx)("span",{children:"Back to Dashboard"})]})}),(0,t.jsxs)("main",{className:"max-w-lg mx-auto p-4 space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Sync Wellness Data"}),(0,t.jsx)("p",{className:"text-zinc-500 mt-1",children:"Connect to Garmin to import your health metrics"})]}),(0,t.jsx)(i,{onSyncComplete:e=>{console.log("Sync completed:",e)},onClose:()=>{e.push("/")}}),(0,t.jsxs)("div",{className:"bg-zinc-900 rounded-2xl border border-zinc-800 p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"How it works"}),(0,t.jsxs)("ul",{className:"space-y-3 text-sm text-zinc-400",children:[(0,t.jsxs)("li",{className:"flex items-start gap-3",children:[(0,t.jsx)("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-teal-900/50 text-teal-400 text-xs font-medium shrink-0",children:"1"}),(0,t.jsx)("span",{children:"Enter your Garmin Connect credentials. Your password is only used for this sync and is not stored."})]}),(0,t.jsxs)("li",{className:"flex items-start gap-3",children:[(0,t.jsx)("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-teal-900/50 text-teal-400 text-xs font-medium shrink-0",children:"2"}),(0,t.jsx)("span",{children:"Select how many days of data to import. More days means longer sync time."})]}),(0,t.jsxs)("li",{className:"flex items-start gap-3",children:[(0,t.jsx)("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-teal-900/50 text-teal-400 text-xs font-medium shrink-0",children:"3"}),(0,t.jsx)("span",{children:"Your wellness data is saved locally. The dashboard will update with your metrics."})]})]})]}),(0,t.jsxs)("div",{className:"bg-zinc-900 rounded-2xl border border-zinc-800 p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Data Types Synced"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:[{name:"Sleep",color:"purple"},{name:"HRV",color:"green"},{name:"Stress",color:"orange"},{name:"Body Battery",color:"yellow"},{name:"Steps",color:"blue"},{name:"Resting HR",color:"red"}].map(e=>(0,t.jsx)("span",{className:`px-3 py-1.5 bg-${e.color}-500/20 text-${e.color}-400 text-sm rounded-full`,style:{backgroundColor:`color-mix(in srgb, var(--${e.color}-500, #888) 20%, transparent)`,color:`var(--${e.color}-400, #aaa)`},children:e.name},e.name))}),(0,t.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2",children:[(0,t.jsx)("span",{className:"px-3 py-1.5 bg-purple-500/20 text-purple-400 text-sm rounded-full",children:"Sleep"}),(0,t.jsx)("span",{className:"px-3 py-1.5 bg-green-500/20 text-green-400 text-sm rounded-full",children:"HRV"}),(0,t.jsx)("span",{className:"px-3 py-1.5 bg-orange-500/20 text-orange-400 text-sm rounded-full",children:"Stress"}),(0,t.jsx)("span",{className:"px-3 py-1.5 bg-yellow-500/20 text-yellow-400 text-sm rounded-full",children:"Body Battery"}),(0,t.jsx)("span",{className:"px-3 py-1.5 bg-blue-500/20 text-blue-400 text-sm rounded-full",children:"Steps"}),(0,t.jsx)("span",{className:"px-3 py-1.5 bg-red-500/20 text-red-400 text-sm rounded-full",children:"Resting HR"})]})]})]})]})}e.s(["default",()=>o],2296)},41283,e=>{e.v(t=>Promise.all(["static/chunks/ecb455d830c14f9c.js"].map(t=>e.l(t))).then(()=>t(82966)))}]);